<!DOCTYPE html>
<html>
  <head>
    <title></title>
    <meta name=description content="">
    <meta name=keywords content="">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1, minimum-scale=1.0,maximum-scale=1.0,user-scalable=no,minimal-ui"/>
    <meta name="format-detection" content="telephone=no"/>
    <meta name="apple-mobile-web-app-capable" content="no" />  
    <style type="text/css">
      body {
        height: 100%;
        width: 100%;       
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        margin: 0;         
      }
      .msgwrap {
        color: #ccc;
        text-align: center;
        display: none;
        -webkit-transform: translate3d(0, 0px, 0);
        transform: translate3d(0, 0px, 0); 
      }
      .contentwrap {       
        overflow: auto;
        height: 100%;
        text-align: center;
        -webkit-overflow-scrolling: touch;
      }
      ul {
        padding: 0;
        margin: 0;
      }
      li {
        list-style: none;
        text-align: left;
        margin-left: 40%;
      }
      .contentwrap .loading {
        display: none;
        text-align: center;
        position: relative;
      }
      .contentwrap .loading::after {
        content: '加载中....';
        margin-left: 20px;
      }
      .contentwrap .ui-page-loading-circle {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border-color: transparent;
        position: absolute;
        left: 35%;
        top: 20%;
        -webkit-animation: loading 690ms infinite linear;
        animation: loading 690ms infinite linear;
        -webkit-box-shadow: 1px 0 0 rgba(0,0,0,0.4);
        box-shadow: 1px 0 0 rgba(0,0,0,0.4);
      }
      @keyframes loading {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }
    </style>  
  </head>
  <body>    
    <div class="contentwrap js-content">
      <div class="msgwrap js-msgwrap"></div>
      <ul class="js-ul">
        <li>我是内容1</li>
        <li>我是内容2</li>
        <li>我是内容3</li>
        <li>我是内容4</li>
        <li>我是内容5</li>
        <li>我是内容6</li>
        <li>我是内容7</li>
        <li>我是内容8</li>
        <li>我是内容9</li>
        <li>我是内容10</li>
        <li>我是内容11</li>      
        <li>我是内容12</li>
        <li>我是内容13</li>
        <li>我是内容14</li>
        <li>我是内容15</li>
        <li>我是内容16</li>
        <li>我是内容17</li>
        <li>我是内容18</li>
        <li>我是内容19</li>
        <li>我是内容20</li>
        <li>我是内容21</li>
        <li>我是内容22</li>
        <li>我是内容23</li>
        <li>我是内容24</li>
        <li>我是内容25</li>
        <li>我是内容26</li>
        <li>我是内容27</li>
        <li>我是内容28</li>
        <li>我是内容29</li>
        <li>我是内容30</li>
        <li>我是内容31</li>
        <li>我是内容32</li>      
        <li>我是内容33</li>
        <li>我是内容34</li>
        <li>我是内容35</li>
        <li>我是内容36</li>
        <li>我是内容37</li>
        <li>我是内容38</li>
        <li>我是内容39</li>
        <li>我是内容40</li>
        <li>我是内容41</li>
        <li>我是内容42</li>
      </ul>
      <div class="loading js-loading">
        <div class="ui-page-loading-circle"></div>
      </div>
    </div>
    <script type="text/javascript" src="./bundle.js"></script>

    <script type="text/javascript">    
      var Pull = mScroll.pull;
      var More = mScroll.more;
      var refresh = new Pull ('.js-content', {
        MsgElement: '.js-msgwrap',
        msgs: ['下拉刷新.....', '释放刷新'],
        distance: 10,
        start: function () {
          //console.info('start');
        },
        move: function () {
          //console.info('move');
        },
        end: function () {
          //console.info('end');
        },
        onRefresh: function () {
          let ul = document.querySelector('.js-ul');                    
          let random = 1; 
          // after refresh do something you want
          setTimeout(() => {           
            this.backTop();
            ul.innerHTML = '';
            for (let i = 0; i< 20; i++) {
              random = (Math.random() * (20 - 1) + 1).toFixed(0);
              ul.innerHTML +=`<li>
                              我是刷新后内容${random}
                             </li>`;
            }
          }, 1000);
        }
      });
      
      var load = new More ('.js-content', {
        main: '.js-content',        
        more: function () {
          loadMore();
        }
      });      
      load.start();
      function loadMore() {
        // 请求接口
        var $ = load.$();
        var $loading = $('.js-loading');
        $loading.show(); 
        let ul = document.querySelector('.js-ul');                    
        let random = 1;             
        setTimeout(() => {
          if ($loading && $loading.length) {
            $loading.hide(); 
            for (let i = 0; i< 5; i++) {
              random = (Math.random() * (20 - 1) + 1).toFixed(0);
              ul.innerHTML +=`<li>
                              我是加载更多内容${random}
                             </li>`;
            }
          }
          load.$el.one('load-bottom', loadMore);
        }, 1000);
      }
    </script>
  </body>
</html>